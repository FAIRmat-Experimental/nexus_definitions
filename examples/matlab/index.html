



<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>2.1.3. MATLAB Examples &#8212; nexus v2020.1rc2 documentation</title>
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/blockquote.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="2.1.4. Viewing 2-D Data from LRMECS" href="../lrmecs/index.html" />
    <link rel="prev" title="h5py example writing a simple NeXus data file with links" href="../h5py/writer_2_1.html" /> 
    <link rel="stylesheet" href="../../_static/blockquote.css" type="text/css" />

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../lrmecs/index.html" title="2.1.4. Viewing 2-D Data from LRMECS"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../h5py/writer_2_1.html" title="h5py example writing a simple NeXus data file with links"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">nexus v2020.1rc2 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U"><span class="section-number">2. </span>Examples of writing and reading NeXus data files</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">2.1.3. MATLAB Examples</a><ul>
<li><a class="reference internal" href="#input-dat">2.1.3.1. <code class="docutils literal notranslate"><span class="pre">input.dat</span></code></a></li>
<li><a class="reference internal" href="#writing-data">2.1.3.2. writing data</a></li>
<li><a class="reference internal" href="#reading-data">2.1.3.3. reading data</a></li>
<li><a class="reference internal" href="#writing-data-file-with-links">2.1.3.4. writing data file with links</a></li>
<li><a class="reference internal" href="#downloads">2.1.3.5. Downloads</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../h5py/writer_2_1.html"
                        title="previous chapter"><code class="docutils literal notranslate"><span class="pre">h5py</span></code> example writing a simple NeXus data file with links</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../lrmecs/index.html"
                        title="next chapter"><span class="section-number">2.1.4. </span>Viewing 2-D Data from LRMECS</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/examples/matlab/index.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
<div id="google_search" style="display: none">
	<hr />
	<h3>Google search</h3>
	<form method="get" action="http://www.google.com/search">
		<table border="0" align="center" cellpadding="0">
			<tr>
				<td>
					<input type="text"   name="q" value="" />
				</td>
			</tr>
			<tr>
				<td align="center" style="font-size:75%">
					<input type="radio"  name="sitesearch" value="" />global
					<input type="radio"  name="sitesearch"
						value="manual.nexusformat.org" 
						checked />NeXus manual
					<input type="submit" value="Go" />
					<br />
				</td>
			</tr>
		</table>
	</form>                                
</div>
<script type="text/javascript">$('#google_search').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <span class="target" id="index-0"></span><div class="section" id="matlab-examples">
<span id="id1"></span><h1><span class="section-number">2.1.3. </span>MATLAB Examples<a class="headerlink" href="#matlab-examples" title="Permalink to this headline">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">author</dt>
<dd class="field-odd"><p>Paul Kienzle, NIST</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Editor’s Note</strong>:
These files were copied directly from an older version
of the NeXus documentation (DocBook) and have not been checked
that they will run under current Matlab versions.</p>
</div>
<div class="section" id="input-dat">
<h2><span class="section-number">2.1.3.1. </span><code class="docutils literal notranslate"><span class="pre">input.dat</span></code><a class="headerlink" href="#input-dat" title="Permalink to this headline">¶</a></h2>
<p>This is the same data used with <a class="reference internal" href="../h5py/index.html#example-h5py"><span class="std std-ref">Python Examples using h5py</span></a>.</p>
<div class="highlight-text notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre><span></span>17.92608    1037
17.92591    1318
17.92575    1704
17.92558    2857
17.92541    4516
17.92525    9998
17.92508    23819
17.92491    31662
17.92475    40458
17.92458    49087
17.92441    56514
17.92425    63499
17.92408    66802
17.92391    66863
17.92375    66599
17.92358    66206
17.92341    65747
17.92325    65250
17.92308    64129
17.92291    63044
17.92275    60796
17.92258    56795
17.92241    51550
17.92225    43710
17.92208    29315
17.92191    19782
17.92175    12992
17.92158    6622
17.92141    4198
17.92125    2248
17.92108    1321
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="writing-data">
<h2><span class="section-number">2.1.3.2. </span>writing data<a class="headerlink" href="#writing-data" title="Permalink to this headline">¶</a></h2>
<div class="compound">
<p class="compound-first rubric"><em>basic_writer.m</em>: Write a NeXus HDF5 file using Matlab</p>
<div class="compound-last highlight-text notranslate" id="example-matlab-basicwriter"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50</pre></div></td><td class="code"><div class="highlight"><pre><span></span>% Writes a NeXus HDF5 file using matlab

disp &#39;Write a NeXus HDF5 file&#39;
filename = &#39;prj_test.nexus.hdf5&#39;;
timestamp = &#39;2010-10-18T17:17:04-0500&#39;;

% read input data
A = load(&#39;input.dat&#39;);
mr = A(:,1);
I00 = int32(A(:,2));

% clear out old file, if it exists

delete(filename);

% using the simple h5 interface, there is no way to create a group without
% first creating a dataset; creating the dataset creates all intervening
% groups.

% store x
h5create(filename,&#39;/entry/mr_scan/mr&#39;,[length(mr)]);
h5write(filename,&#39;/entry/mr_scan/mr&#39;,mr);
h5writeatt(filename,&#39;/entry/mr_scan/mr&#39;,&#39;units&#39;,&#39;degrees&#39;);
h5writeatt(filename,&#39;/entry/mr_scan/mr&#39;,&#39;long_name&#39;,&#39;USAXS mr (degrees)&#39;);

% store y
h5create(filename,&#39;/entry/mr_scan/I00&#39;,[length(I00)],&#39;DataType&#39;,&#39;int32&#39;);
h5write(filename,&#39;/entry/mr_scan/I00&#39;,I00);
h5writeatt(filename,&#39;/entry/mr_scan/I00&#39;,&#39;units&#39;,&#39;counts&#39;);
h5writeatt(filename,&#39;/entry/mr_scan/I00&#39;,&#39;long_name&#39;,&#39;USAXS I00 (counts)&#39;);

% indicate that we are plotting y vs. x
h5writeatt(filename,&#39;/&#39;,&#39;default&#39;,&#39;entry&#39;);
h5writeatt(filename,&#39;/entry&#39;,&#39;default&#39;,&#39;mr_scan&#39;);
h5writeatt(filename,&#39;/entry/mr_scan&#39;,&#39;signal&#39;,&#39;I00&#39;);
h5writeatt(filename,&#39;/entry/mr_scan&#39;,&#39;axes&#39;,&#39;mr_scan&#39;);
h5writeatt(filename,&#39;/entry/mr_scan&#39;,&#39;mr_scan_indices&#39;, int32(0));

% add NeXus metadata
h5writeatt(filename,&#39;/&#39;,&#39;file_name&#39;,filename);
h5writeatt(filename,&#39;/&#39;,&#39;file_time&#39;,timestamp);
h5writeatt(filename,&#39;/&#39;,&#39;instrument&#39;,&#39;APS USAXS at 32ID-B&#39;);
h5writeatt(filename,&#39;/&#39;,&#39;creator&#39;,&#39;basic_writer.m&#39;);
h5writeatt(filename,&#39;/&#39;,&#39;NeXus_version&#39;,&#39;4.3.0&#39;);
h5writeatt(filename,&#39;/&#39;,&#39;HDF5_Version&#39;,&#39;1.6&#39;); % no 1.8 features used in this example
h5writeatt(filename,&#39;/entry&#39;,&#39;NX_class&#39;,&#39;NXentry&#39;);
h5writeatt(filename,&#39;/entry/mr_scan&#39;,&#39;NX_class&#39;,&#39;NXdata&#39;);


h5disp(filename);
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="reading-data">
<h2><span class="section-number">2.1.3.3. </span>reading data<a class="headerlink" href="#reading-data" title="Permalink to this headline">¶</a></h2>
<div class="compound">
<p class="compound-first rubric"><em>basic_reader.m</em>: Read a NeXus HDF5 file using Matlab</p>
<div class="compound-last highlight-text notranslate" id="example-matlab-basicreader"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span>% Reads NeXus HDF5 file and print the contents

filename = &#39;prj_test.nexus.hdf5&#39;;
root = h5info(filename,&#39;/&#39;);
attrs = root.Attributes;
for i = 1:length(attrs)
    fprintf(&#39;%s: %s\n&#39;, attrs(i).Name, attrs(i).Value);
end
mr = h5read(filename,&#39;/entry/mr_scan/mr&#39;);
i00 = h5read(filename, &#39;/entry/mr_scan/I00&#39;);
fprintf(&#39;#\t%s\t%s\n&#39;,&#39;mr&#39;,&#39;I00&#39;);
for i = 1:length(mr)
    fprintf(&#39;%d\t%g\t%d\n&#39;, i, mr(i), i00(i));
end
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="writing-data-file-with-links">
<h2><span class="section-number">2.1.3.4. </span>writing data file with links<a class="headerlink" href="#writing-data-file-with-links" title="Permalink to this headline">¶</a></h2>
<div class="compound">
<p class="compound-first rubric"><em>writer_2_1.m</em>: Write a NeXus HDF5 file with links</p>
<div class="compound-last highlight-text notranslate" id="example-matlab-writer-2-1"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49</pre></div></td><td class="code"><div class="highlight"><pre><span></span>% Writes a simple NeXus HDF5 file with links
% according to the example from Figure 2.1 in the Design chapter

filename = &#39;writer_2_1.hdf5&#39;;

% read input data
A = load(&#39;input.dat&#39;);
two_theta = A(:,1);
counts = int32(A(:,2));

% clear out old file, if it exists
delete(filename);

% store x
h5create(filename,&#39;/entry/instrument/detector/two_theta&#39;,[length(two_theta)]);
h5write(filename,&#39;/entry/instrument/detector/two_theta&#39;,two_theta);
h5writeatt(filename,&#39;/entry/instrument/detector/two_theta&#39;,&#39;units&#39;,&#39;degrees&#39;);

% store y
h5create(filename,&#39;/entry/instrument/detector/counts&#39;,[length(counts)],&#39;DataType&#39;,&#39;int32&#39;);
h5write(filename,&#39;/entry/instrument/detector/counts&#39;,counts);
h5writeatt(filename,&#39;/entry/instrument/detector/counts&#39;,&#39;units&#39;,&#39;counts&#39;);

% create group NXdata with links to detector
% note: requires the additional file h5link.m
h5link(filename,&#39;/entry/instrument/detector/two_theta&#39;,&#39;/entry/data/two_theta&#39;);
h5link(filename,&#39;/entry/instrument/detector/counts&#39;,&#39;/entry/data/counts&#39;);

% indicate that we are plotting y vs. x
h5writeatt(filename,&#39;/&#39;,&#39;default&#39;,&#39;entry&#39;);
h5writeatt(filename,&#39;/entry&#39;,&#39;default&#39;,&#39;data&#39;);
h5writeatt(filename,&#39;/entry/data&#39;,&#39;signal&#39;,&#39;counts&#39;);
h5writeatt(filename,&#39;/entry/data&#39;,&#39;axes&#39;,&#39;two_theta&#39;);
h5writeatt(filename,&#39;/entry/data&#39;,&#39;two_theta_indices&#39;,int32(0));

% add NeXus metadata
h5writeatt(filename,&#39;/&#39;,&#39;file_name&#39;,filename);
h5writeatt(filename,&#39;/&#39;,&#39;file_time&#39;,timestamp);
h5writeatt(filename,&#39;/&#39;,&#39;instrument&#39;,&#39;APS USAXS at 32ID-B&#39;);
h5writeatt(filename,&#39;/&#39;,&#39;creator&#39;,&#39;writer_2_1.m&#39;);
h5writeatt(filename,&#39;/&#39;,&#39;NeXus_version&#39;,&#39;4.3.0&#39;);
h5writeatt(filename,&#39;/&#39;,&#39;HDF5_Version&#39;,&#39;1.6&#39;); % no 1.8 features used in this example
h5writeatt(filename,&#39;/entry&#39;,&#39;NX_class&#39;,&#39;NXentry&#39;);
h5writeatt(filename,&#39;/entry/instrument&#39;,&#39;NX_class&#39;,&#39;NXinstrument&#39;);
h5writeatt(filename,&#39;/entry/instrument/detector&#39;,&#39;NX_class&#39;,&#39;NXdetector&#39;);
h5writeatt(filename,&#39;/entry/data&#39;,&#39;NX_class&#39;,&#39;NXdata&#39;);

% show structure of the file that was created
h5disp(filename);
</pre></div>
</td></tr></table></div>
</div>
<div class="compound">
<p class="compound-first rubric"><em>h5link.m</em>: support module for creating NeXus-style HDF5 hard links</p>
<div class="compound-last highlight-text notranslate" id="example-matlab-h5link"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43</pre></div></td><td class="code"><div class="highlight"><pre><span></span>function h5link(filename, from, to)
%H5LINK Create link to an HDF5 dataset.
%   H5LINK(FILENAME,SOURCE,TARGET) creates an HDF5 link from the
%   dataset at location SOURCE to a dataset at location TARGET.  All
%   intermediate groups in the path to target are created.
%
%   Example:  create a link from /hello/world to /goodbye/world
%      h5create(&#39;myfile.h5&#39;,&#39;/hello/world&#39;,[100 200]);
%      h5link(&#39;myfile.h5&#39;,&#39;/hello/world&#39;,&#39;/goodbye/world&#39;);
%      hgdisp(&#39;myfile.h5&#39;);
%
%   See also: h5create, h5read, h5write, h5info, h5disp

% split from and to into group/dataset
idx = strfind(from,&#39;/&#39;);
from_path = from(1:idx(end)-1);
from_data = from(idx(end)+1:end);
idx = strfind(to,&#39;/&#39;);
to_path = to(1:idx(end)-1);
to_data = to(idx(end)+1:end);
  
% open the HDF file
fid = H5F.open(filename,&#39;H5F_ACC_RDWR&#39;,&#39;H5P_DEFAULT&#39;);
  
% create target group if it doesn&#39;t already exist
create_intermediate = H5P.create(&#39;H5P_LINK_CREATE&#39;);
H5P.set_create_intermediate_group(create_intermediate, 1);
try
    H5G.create(fid,to_path,create_intermediate,&#39;H5P_DEFAULT&#39;,&#39;H5P_DEFAULT&#39;);
catch
end
H5P.close(create_intermediate);

% open groups and create link
from_id = H5G.open(fid, from_path);
to_id = H5G.open(fid, to_path);
H5L.create_hard(from_id, from_data, to_id, to_data, &#39;H5P_DEFAULT&#39;,&#39;H5P_DEFAULT&#39;);

% close all
H5G.close(from_id);
H5G.close(to_id);
H5F.close(fid);
end
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="downloads">
<h2><span class="section-number">2.1.3.5. </span>Downloads<a class="headerlink" href="#downloads" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 30%" />
<col style="width: 70%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>file</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference download internal" download="" href="../../_downloads/f88ddd64c2ac0d68adfa2ac3ad6bb203/input.dat"><code class="xref download docutils literal notranslate"><span class="pre">input.dat</span></code></a></p></td>
<td><p>two-column text data file, also used in other examples</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference download internal" download="" href="../../_downloads/60e67dd4c7a9b02031480f6c683f4c10/basic_writer.m"><code class="xref download docutils literal notranslate"><span class="pre">basic_writer.m</span></code></a></p></td>
<td><p>writes a NeXus HDF5 file using <code class="docutils literal notranslate"><span class="pre">input.dat</span></code></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference download internal" download="" href="../../_downloads/a16269a70f3dd953ba14cfff521c0f79/basic_reader.m"><code class="xref download docutils literal notranslate"><span class="pre">basic_reader.m</span></code></a></p></td>
<td><p>reads the NeXus HDF5 file written by <code class="docutils literal notranslate"><span class="pre">basic_writer.m</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference download internal" download="" href="../../_downloads/36b2d63db078aaa74a2c739feae5e837/h5link.m"><code class="xref download docutils literal notranslate"><span class="pre">h5link.m</span></code></a></p></td>
<td><p>support module for creating NeXus-style HDF5 hard links</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference download internal" download="" href="../../_downloads/68d4685fedacdab239f3b87ea9de1e3f/writer_2_1.m"><code class="xref download docutils literal notranslate"><span class="pre">writer_2_1.m</span></code></a></p></td>
<td><p>like <code class="docutils literal notranslate"><span class="pre">basic_writer.m</span></code> but stores data in
<code class="docutils literal notranslate"><span class="pre">/entry/instrument/detector</span></code>
and then links to <strong>NXdata</strong> group</p></td>
</tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../lrmecs/index.html" title="2.1.4. Viewing 2-D Data from LRMECS"
             >next</a> |</li>
        <li class="right" >
          <a href="../h5py/writer_2_1.html" title="h5py example writing a simple NeXus data file with links"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">nexus v2020.1rc2 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" ><span class="section-number">2. </span>Examples of writing and reading NeXus data files</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; <a href="../../copyright.html">Copyright</a> 1996-2020, NIAC, https://www.nexusformat.org.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.3.1.
    </div>
  </body>
</html>