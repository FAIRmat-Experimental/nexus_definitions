<?xml version="1.0" ?>
<?xml-stylesheet type="text/xsl" href="nxdlformat.xsl"?>
<definition xmlns="http://definition.nexusformat.org/nxdl/3.1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://definition.nexusformat.org/nxdl/3.1 ../nxdl.xsd" extends="NXobject" type="group" category="application" name="NXapm">
    <doc>
         Atom probe tomography and field-ion microscopy experiments.
    </doc>
    <symbols>
        <doc>
             The symbols used in the schema to specify e.g. dimensions of arrays
        </doc>
        <symbol name="Nions">
            <doc>
                 Total number of ions collected
            </doc>
        </symbol>
        <symbol name="Ndldwires">
            <doc>
                 Total number of independent wires in the delay-line detector.
            </doc>
        </symbol>
        <symbol name="Nsupport">
            <doc>
                 Number of support points for e.g. modeling peaks in the mass-to-
                 charge-state ratio histogram.
            </doc>
        </symbol>
        <symbol name="Nivecmax">
            <doc>
                 Maximum number of allowed atoms per (molecular) ion (fragment). Needs
                 to match maximum_number_of_atoms_per_molecular_ion.
            </doc>
        </symbol>
        <symbol name="Nranges">
            <doc>
                 Number of mass-to-charge-state-ratio range intervals mapped on this
                 ion type.
            </doc>
        </symbol>
    </symbols>
    <group type="NXentry">
        <field name="definition" type="NX_CHAR">
            <doc>
                 Official NeXus NXDL schema to which this entry conforms.
            </doc>
            <attribute name="version" type="NX_CHAR">
                <doc>
                     Version specifier which enables documentation of modifications to the
                     schema.
                </doc>
            </attribute>
        </field>
        <field name="experiment_identifier" type="NX_CHAR">
            <doc>
                 Ideally, a (globally) persistent unique identifier for referring to
                 this experiment. The identifier is usually defined/issued by the
                 facility, laboratory, or the principle investigator. The identifier
                 enables to link experiments to e.g. proposals.
            </doc>
        </field>
        <field name="experiment_description" type="NX_CHAR" optional="true">
            <doc>
                 Possibility for leaving a free-text description about the experiment.
                 Users are strongly advised to detail the sample history in the
                 respective field and fill rather as completely as possible the fields
                 of this application definition rather than writing these details in
                 prose into this field here.
            </doc>
        </field>
        <field name="start_time" type="NX_DATE_TIME">
            <doc>
                 ISO 8601 formatted time code with local time zone offset to UTC
                 information included when the experiment started. If the application
                 demands that time codes in this section of the application definition
                 should only be used for specifying when the experiment was performed -
                 and the exact duration of the experiment is not relevant - this start
                 time field should be used. Often though it is useful to specify a time
                 interval, i.e. start_time and end_time, to allow for more detailed
                 bookkeeping and interpretation of the experiment. The user should be
                 aware that even with having both time instances specified it may not
                 be advisable to infer how long the experiment took or for how long
                 data were acquired. More detailed timing data over the course of the
                 experiment have to be collected for such a detailed bookkeeping.
            </doc>
        </field>
        <field name="end_time" type="NX_DATE_TIME" recommended="true">
            <doc>
                 ISO 8601-formatted time code with local time zone offset to UTC
                 included when the experiment ended.
            </doc>
        </field>
        <field name="program" type="NX_CHAR">
            <doc>
                 Commercial or otherwise given name to the program that was used to
                 acquire/measure the dataset. Atom probe microscopy experiments are
                 nowadays still in most cases controlled via commercial software. These
                 are often designed as integrated acquisition and instrument control
                 software. For AMETEK/Cameca local electrode atom probe (LEAP)
                 instruments the least processed (rawest) numerical results and
                 metadata are stored in so-called RHIT and HITS files, which are
                 proprietary. Supplementary metadata are kept in a database which is
                 connected to the control software. RHIT and HITS are proprietary
                 binary file formats whose content must not be accessed with software
                 other than of AMETEK (IVAS/AP Suite). In effect, RHIT and HITS store
                 the experiment in a closed manner that is practically useless for
                 users unless they have access to the commercial software. To arrive at
                 a state that atom probe microscopy delivers a dataset with which one
                 can study reconstructed atomic position and do e.g. composition
                 analyses or other post-processing analysis tasks, these raw data have
                 to be processed. Therefore, it is necessary that for an application
                 definition to be useful, details about the physical acquisition of the
                 raw data and all its processing steps have to be stored. With this a
                 user can create derived quantities like ion hit positions (on the
                 detector), calibrated time-of-flight data. These derived quantities
                 are also need to obtain calibrated mass-to-charge-state ratios, and
                 finally the tomographically reconstructed atomic positions. In many
                 cases cases, an APM dataset is useful only if it gets post-processed
                 via so-called ranging. Ranging defines a set of rules how one map
                 between time-of-flight and mass-to-charge data on ion types, i.e.
                 labels. In turn, these labels decode elemental identities and resolve
                 isotopes. All these steps are in most cases performed using commercial
                 software. Frequently, though, ranging and post-processing is also
                 performed with (open-source) research software. Therefore, there is
                 strictly speaking not a single program used in atom probe not even for
                 the early data acquisition and processing stages until one arrives at
                 a useful reconstructed and ranged dataset. Therefore, the application
                 definition documents not only the measurement but also these key post-
                 processing steps.
            </doc>
            <attribute name="version" type="NX_CHAR">
                <doc>
                     Ideally program version plus build number, or commit hash or
                     description of ever persistent resources where the source code of the
                     program and build instructions can be found so that the program can be
                     configured ideally in such a manner that the result file is
                     numerically recreatable in the same deterministic manner.
                </doc>
            </attribute>
        </field>
        <field name="run_number" type="NX_CHAR">
            <doc>
                 Not the specimen name or the experiment identifier but the identifier
                 through which the experiment is referred to in the control software.
                 For LEAP instruments it is recommended to use the IVAS/AP Suite run
                 number. For other instruments, such as the one from Stuttgart or
                 Oxcart from Erlangen, or the instruments in Rouen, use the identifier
                 that is closest in meaning to the LEAP run number. As a destructive
                 microscopy method, a run can be performed only once. It is possible,
                 however, to interrupt a run and restart data acquisition while still
                 using the same specimen. In this case, each evaporation run needs to
                 be distinguished with different run numbers. # This is how most atom
                 probe groups handle it across the globe.
            </doc>
        </field>
        <group name="experiment_documentation" type="NXnote" optional="true">
            <doc>
                 Binary container for a file or a compressed collection of files which
                 can be used to add further descriptions and details to the experiment.
                 The container can hold e.g. a ppt, pdf, latex, txt, image, or zip
                 archive ...).
            </doc>
        </group>
        <group name="thumbnail" type="NXnote" recommended="true">
            <doc>
                 A small image that is representative of the entry. For reconstructed
                 datasets it is recommended to display the reconstruction as a 640x480
                 pixel jpeg image. Adding a scale bar to that image is recommended but
                 not required as the main purpose of the thumbnail is to provide e.g.
                 thumbnail images for displaying them in data repositories.
            </doc>
            <attribute name="type"/>
        </group>
        <field name="operation_mode" type="NX_CHAR">
            <doc>
                 What type of atom probe microscope experiment is performed. This field
                 can be used e.g. by materials database systems to qualitatively filter
                 experiments.
            </doc>
            <enumeration>
                <item value="leap"/>
                <item value="apt"/>
                <item value="fim"/>
                <item value="apt_and_fim"/>
            </enumeration>
        </field>
        <group name="operator" type="NXuser" minOccurs="1">
            <doc>
                 Contact information of at least the user of the instrument who
                 measured this specimen or the principle investigator who performed
                 this experiment. Adding multiple users if relevant is recommended.
            </doc>
            <field name="name" type="NX_CHAR">
                <doc>
                     Given (first) name and surname of the user.
                </doc>
            </field>
            <field name="affiliation" type="NX_CHAR" recommended="true">
                <doc>
                     Name of the affiliation of the user at the point in time when the
                     experiment was performed.
                </doc>
            </field>
            <field name="address" type="NX_CHAR" recommended="true">
                <doc>
                     Postal address of the affiliation.
                </doc>
            </field>
            <field name="email" type="NX_CHAR">
                <doc>
                     Email address of the user at the point in time when the experiment was
                     performed. Giving the most permanently used email is recommended.
                </doc>
            </field>
            <field name="orcid" type="NX_CHAR" recommended="true">
                <doc>
                     Globally unique identifier of the user as offers by services like
                     ORCID or ResearcherID.
                </doc>
            </field>
            <field name="telephone_number" type="NX_CHAR" recommended="true">
                <doc>
                     (Business) (tele)phone number of the user at the point in time when
                     the experiment was performed.
                </doc>
            </field>
            <field name="role" type="NX_CHAR" recommended="true">
                <doc>
                     Which role does the user have in the place, or did the user hold when,
                     the experiment was performed (e.g. technician operating the
                     microscope, student, postdoc, principle investigator, guest ...).
                </doc>
            </field>
        </group>
        <group name="specimen" type="NXsample">
            <field name="name" type="NX_CHAR">
                <doc>
                     Descriptive name or identifier with which to distinguish the specimen
                     from all others and especially the parts from where it was cut. In
                     cases where the specimen was e.g. site-specifically cut from samples
                     or in cases of an instrument session during which multiple specimens
                     are loaded, the name has to be descriptive enough to resolve which
                     specimen on e.g. the microtip array was taken. The user is advised to
                     store the details how specimens were cut/prepared from samples in the
                     sample history.
                </doc>
            </field>
            <field name="sample_history" type="NX_CHAR">
                <doc>
                     Ideally, a reference to the location of or a (globally persistent)
                     unique identifier of e.g. another file which should document ideally
                     as many details as possible of the material, its microstructure, and
                     its thermo-chemo-mechanical processing/preparation history. In the
                     case that such a detailed history of the sample/specimen is not
                     available, use this field as a free-text description to specify a sub-
                     set of the entire sample history, i.e. what you would consider being
                     the key steps and relevant information about the specimen, its
                     material, microstructure, thermo-chemo-mechanical processing state and
                     details of the preparation.
                </doc>
            </field>
            <field name="preparation_date" type="NX_DATE_TIME" recommended="true">
                <doc>
                     ISO8601 date and time with local time zone offset to UTC included when
                     the specimen was prepared. Ideally report the end of the preparation,
                     i.e. the last known time the measured specimen surface was actively
                     prepared. Knowing when the specimen was exposed to e.g. specific
                     atmosphere is especially required for environmentally sensitive
                     material such as hydrogen-charged specimens or experiments including
                     tracers with a short half-time. The user is advised to include these
                     temporal details in the sample_history.
                </doc>
            </field>
            <field name="short_title" type="NX_CHAR" optional="true">
                <doc>
                     Possibility to give an abbreviation of the specimen name field.
                </doc>
            </field>
            <field name="atom_types" type="NX_CHAR">
                <doc>
                     Use Hill's system for listing elements of the periodic table which are
                     inside or attached to the surface of the specimen and thus considered
                     relevant from a scientific point. The purpose of the field is to offer
                     materials database systems an opportunity to parse the relevant
                     elements without having to interpret these from the sample history.
                </doc>
            </field>
        </group>
        <group type="NXdata">
            <doc>
                 Hard link to a location/locations in the hierarchy of the NeXus file
                 where the data for default plotting are stored.
            </doc>
        </group>
        <group name="atom_probe" type="NXinstrument">
            <doc>
                 Metadata and numerical data of not only the microscope but also the
                 lab in which this microscope is located. An atom probe microscope
                 (experiment) is different compared to a large-scale facility
                 accelerator or an electron microscope in at least two ways. First,
                 ionized atoms and molecular ion(s fragments) (in the case of atom
                 probe tomography) and (primarily) imaging gas ions (in the case of
                 field ion microscopy) are accelerated towards a position-sensitive and
                 time-of-flight taking detector system. Hence, there is no real
                 probe/beam. Second, the specimen is the lens of an atom probe
                 microscope. Therefore, the reference coordinate system that is usually
                 referred to in NeXus (McStas coordinate system) is modified when using
                 this application definition. Specifically, the reference coordinate
                 system is defined such that it represents the specimen coordinate
                 system. To be consistent with accelerator and microscopy techniques we
                 define that the positive z-axis points outwards from the apex of the
                 specimen into the vacuum, i.e. towards the detector. The coordinate
                 system remains/is a right-handed one. Clockwise rotations are
                 considered positive rotations.
            </doc>
            <field name="name" type="NX_CHAR">
                <doc>
                     Given name of the microscope, e.g Raptor, Oxcart, One atom at a time.
                </doc>
            </field>
            <field name="location" type="NX_CHAR" recommended="true">
                <doc>
                     Geographic coordinates of the lab or the place where the instrument is
                     installed using GEOREF geocodes ideally.
                </doc>
            </field>
            <field name="instrument_manufacturer" type="NX_CHAR" recommended="true">
                <doc>
                     Manufacturer of the entire instrument (e.g. AMETEK/Cameca) to enable
                     e.g. queries in materials database systems for instrument
                     manufacturers. Usually more technical details are needed though to
                     specify the instrument, these should be written into instrument_model
                     and instrument_capabilities.
                </doc>
            </field>
            <field name="instrument_model" type="NX_CHAR">
                <doc>
                     Manufacturer brand/model to enable e.g. queries about microscope
                     models (e.g. LEAP3000XS).
                </doc>
            </field>
            <field name="instrument_identifier" type="NX_CHAR" recommended="true">
                <doc>
                     Hardware name/serial number or hash identifier given by the
                     manufacturer to identify the instrument.
                </doc>
            </field>
            <field name="instrument_capability" type="NX_CHAR" recommended="true">
                <doc>
                     Free-text list possibly multiple terms of functionalities which the
                     instrument provides.
                </doc>
            </field>
            <field name="flight_path_length" type="NX_FLOAT" units="NX_LENGTH">
                <doc>
                     The space inside the atom probe that ions pass through when they leave
                     the specimen and travel to the detector.
                </doc>
            </field>
            <group name="analysis_chamber" type="NXchamber" optional="true"/>
            <group name="load_lock_chamber" type="NXchamber" optional="true"/>
            <group name="buffer_chamber" type="NXchamber" optional="true"/>
            <group name="getter_pump" type="NXpump" optional="true"/>
            <group name="roughening_pump" type="NXpump" optional="true"/>
            <group name="turbomolecular_pump" type="NXpump" optional="true"/>
            <field name="has_reflectron" type="NX_BOOLEAN" recommended="true"/>
            <group type="NXreflectron" recommended="true">
                <doc>
                     Device for reducing flight time differences of ions in ToF
                     experiments.
                </doc>
                <field name="name" type="NX_CHAR" recommended="true">
                    <doc>
                         Given name.
                    </doc>
                </field>
                <field name="model" type="NX_CHAR" recommended="true">
                    <doc>
                         Given brand or model name by the manufacturer.
                    </doc>
                </field>
                <field name="serial_number" type="NX_CHAR" recommended="true">
                    <doc>
                         Given hardware name/serial number or hash identifier issued by the
                         manufacturer.
                    </doc>
                </field>
                <field name="manufacturer_name" type="NX_CHAR" recommended="true">
                    <doc>
                         Given name of the manufacturer.
                    </doc>
                </field>
                <field name="description" type="NX_CHAR" recommended="true">
                    <doc>
                         Free-text field to specify further details about the reflectron. The
                         quantity can inform for instance if the reflectron is flat or curved.
                    </doc>
                </field>
                <group type="NXtransformations" optional="true">
                    <doc>
                         Affine transformation(s) which detail where the reflectron is located
                         relative to e.g. the origin of the specimen space reference coordinate
                         system. This group can also be used for specifying how the reflectron
                         is rotated relative to the specimen axis. The purpose of these more
                         detailed instrument descriptions is to support the creation of a
                         digital twin of the instrument for computational science.
                    </doc>
                </group>
            </group>
            <group name="flat_test_data" type="NXcollection" recommended="true">
                <doc>
                     NEED FOR FURTHER DISCUSSIONS WITH APM COLLEAGUES WHAT IS RELEVANT
                     HERE.
                </doc>
            </group>
            <group name="counter_electrode" type="NXaperture">
                <field name="description" type="NX_CHAR" recommended="true">
                    <doc>
                         An (ideally globally persistent) unique identifier, link, or text
                         which gives further details.
                    </doc>
                </field>
            </group>
            <group name="ion_detector" type="NXdetector">
                <doc>
                     Details about the detector which is used to collect raw time-of-flight
                     data and ion/hit impact positions.
                </doc>
                <field name="type" type="NX_CHAR" recommended="true">
                    <doc>
                         Description of the detector type. Specify if the detector is not the
                         usual type of delay-line detectors.
                    </doc>
                    <enumeration>
                        <item value="mcp_dld"/>
                        <item value="phosphor_ccd"/>
                    </enumeration>
                </field>
                <field name="name" type="NX_CHAR" recommended="true">
                    <doc>
                         Given name.
                    </doc>
                </field>
                <field name="model" type="NX_CHAR" recommended="true">
                    <doc>
                         Given brand or model name by the manufacturer.
                    </doc>
                </field>
                <field name="serial_number" type="NX_CHAR" recommended="true">
                    <doc>
                         Given hardware name/serial number or hash identifier issued by the
                         manufacturer.
                    </doc>
                </field>
                <field name="manufacturer_name" type="NX_CHAR" recommended="true">
                    <doc>
                         Given name of the manufacturer.
                    </doc>
                </field>
                <field name="signal_amplitude" type="NX_FLOAT" optional="true" units="NX_CURRENT">
                    <doc>
                         Amplitude of the signal detected on the multi-channel plate (MCP).
                         This field should be used for storing the signal amplitude quantity
                         within ATO files. The ATO file format is used primarily by the atom
                         probe groups in Rouen, France.
                    </doc>
                    <dimensions rank="1">
                        <dim index="1" value="Nions"/>
                    </dimensions>
                </field>
                <group type="NXtransformations" optional="true">
                    <doc>
                         Affine transformation which aligns the Cartesian right-handed
                         coordinate system which defines the detector space with the specimen
                         space. In atom probe microscopy a frequently used choice is to discuss
                         the so-called detector space image (stack). This is a stack of two-
                         dimensional histograms of detected ions within a predefined
                         evaporation ID interval. Typically, the set of ion evaporation
                         sequence IDs is grouped into chunks. For each chunk a histogram of the
                         ion hit positions on the detector is computed. This leaves the
                         possibility for inconsistency between the so-called detector
                         coordinate system and a specimen-affixed coordinate system. The
                         transformation here resolves this ambiguity by specifying how the
                         positive z-axes of either coordinate systems can be oriented.
                    </doc>
                </group>
            </group>
            <group name="pulser" type="NXpulser_apm">
                <field name="pulse_mode" type="NX_CHAR">
                    <enumeration>
                        <item value="laser"/>
                        <item value="high_voltage"/>
                        <item value="laser_and_high_voltage"/>
                    </enumeration>
                </field>
                <group name="laser_pulser" type="NXsource" optional="true">
                    <doc>
                         Atom probe microscopes use controlled laser, voltage, or a combination
                         of pulsing strategies to trigger the excitation and eventual field
                         evaporation/emission of an ion in an atom probe microscopy experiment.
                         # Many microscopes have a laser installed which enables measurements
                         also with poorly conductive specimens.
                    </doc>
                    <field name="name" type="NX_CHAR" recommended="true">
                        <doc>
                             Given name.
                        </doc>
                    </field>
                    <field name="model" type="NX_CHAR" recommended="true">
                        <doc>
                             Given brand or model name by the manufacturer.
                        </doc>
                    </field>
                    <field name="serial_number" type="NX_CHAR" recommended="true">
                        <doc>
                             Given hardware name/serial number or hash identifier issued by the
                             manufacturer.
                        </doc>
                    </field>
                    <field name="manufacturer_name" type="NX_CHAR" recommended="true">
                        <doc>
                             Given name of the manufacturer.
                        </doc>
                    </field>
                    <field name="wavelength" type="NX_FLOAT" units="NX_WAVELENGTH">
                        <doc>
                             Nominal wavelength of the laser radiation.
                        </doc>
                    </field>
                    <field name="power" type="NX_FLOAT" recommended="true" units="NX_POWER">
                        <doc>
                             Average power of the laser source while illuminating the specimen.
                        </doc>
                    </field>
                    <field name="pulse_energy" type="NX_FLOAT" recommended="true" units="NX_ENERGY">
                        <doc>
                             Average (??) energy of the laser at peak of (each) ?? pulse.
                        </doc>
                    </field>
                    <group type="NXtransformations" recommended="true">
                        <doc>
                             Set of transformations which describe the geometry between how the
                             laser focusing optics/pinhole-attached coordinate system is defined,
                             how it has to be transformed so that it aligns with the specimen
                             coordinate system. A right-handed Cartesian coordinate system, the so-
                             called laser space, should be assumed, whose positive z-axis points
                             into the direction of the propagating laser beam.
                        </doc>
                    </group>
                </group>
                <group name="laser_beam" type="NXbeam" optional="true">
                    <doc>
                         Details about specific positions along the focused laser beam which
                         illuminates the atom probe specimen.
                    </doc>
                    <group name="pinhole_position" type="NXcollection" recommended="true">
                        <doc>
                             Track time-dependent settings over the course of the measurement where
                             the laser beam exits the focusing optics.
                        </doc>
                    </group>
                    <group name="spot_position" type="NXcollection" recommended="true">
                        <doc>
                             Track time-dependent settings over the course of the measurement where
                             the laser hits the specimen.
                        </doc>
                    </group>
                </group>
                <field name="pulse_frequency" type="NX_NUMBER" units="NX_FREQUENCY">
                    <doc>
                         Frequency with which the high voltage or laser pulser fires.
                    </doc>
                </field>
                <field name="pulse_fraction" type="NX_NUMBER" units="NX_UNITLESS">
                    <doc>
                         Fraction of the pulse_voltage that is applied in addition to the
                         standing_voltage at peak voltage of a pulse.
                    </doc>
                </field>
                <field name="pulsed_voltage" type="NX_FLOAT" recommended="true" units="NX_VOLTAGE">
                    <doc>
                         NEED TO DISCUSS WITH APM COLLEAGUES IN MORE DETAIL WHAT THIS IS
                         SPECIFICALLY!
                    </doc>
                    <dimensions rank="1">
                        <dim index="1" value="Nions"/>
                    </dimensions>
                </field>
                <field name="standing_voltage" type="NX_FLOAT" recommended="true" units="NX_VOLTAGE">
                    <doc>
                         Direct current voltage between the specimen and the (local electrode)
                         in the case of a LEAP instrument.
                    </doc>
                    <dimensions rank="1">
                        <dim index="1" value="Nions"/>
                    </dimensions>
                </field>
            </group>
            <group type="NXstage_lab">
                <field name="design" type="NX_CHAR" recommended="true">
                    <doc>
                         Principal design of the stage.
                    </doc>
                </field>
                <field name="name" type="NX_CHAR" recommended="true">
                    <doc>
                         Given name.
                    </doc>
                </field>
                <field name="model" type="NX_CHAR" recommended="true">
                    <doc>
                         Given brand or model name by the manufacturer.
                    </doc>
                </field>
                <field name="serial_number" type="NX_CHAR" recommended="true">
                    <doc>
                         Given hardware name/serial number or hash identifier issued by the
                         manufacturer.
                    </doc>
                </field>
                <field name="manufacturer_name" type="NX_CHAR" recommended="true">
                    <doc>
                         Given name of the manufacturer.
                    </doc>
                </field>
                <field name="description" type="NX_CHAR" optional="true">
                    <doc>
                         Ideally a link to a (globally persistent) unique identifier which
                         documents or can be used to infer further details of the component. If
                         such a resource is not available, use this field for a free-text
                         description and describe further details to the stage.
                    </doc>
                </field>
                <group type="NXtransformations" optional="true">
                    <doc>
                         Set of transformations which describe how the stage-affixed coordinate
                         system is defined and how it has to be transformed so that it aligns
                         with the specimen coordinate system.
                    </doc>
                </group>
                <group type="NXpositioner" optional="true"/>
                <field name="base_temperature" type="NX_FLOAT" units="NX_TEMPERATURE">
                    <doc>
                         Average temperature at the specimen base, i.e. base temperature,
                         during the measurement.
                    </doc>
                </field>
            </group>
            <group name="control_software" type="NXcollection">
                <doc>
                     The majority of atom probe microscopes come from a single commercial
                     manufacturer AMETEK (formerly Cameca). Their instruments are
                     controlled via an(/a set) of integrated instrument control system(s)
                     (APSuite/IVAS/DAVis). By contrast, instruments which were built by
                     individual research groups such as of the French (GPM, Rouen, France),
                     the Schmitz (Inspico, Stuttgart, Germany), the Felfer (Oxcart,
                     Erlangen, Germany), the Northwestern (D. Isheim, Seidman group et
                     al.), or the PNNL group (Pacific Northwest National Laborary,
                     Portland, Oregon, U.S.) have individual solutions to control the
                     instrument. Some of which are modularized and open, some of which
                     realize also integrated control units with portions of eventually
                     undisclosed source code and (so far) lacking (support of)/open APIs.
                     Currently, there is no accepted/implemented community-specific API for
                     getting finely granularized access to such control settings. This
                     motivates the current design of the application definition which
                     stores quantities to begin with via an NXcollection. Holding
                     heterogeneous, not yet standardized, but relevant pieces of
                     information is the purpose of this collection.
                </doc>
                <group name="analysis_chamber" type="NXcollection">
                    <doc>
                         Track time-dependent settings over the course of the measurement about
                         the environment in the analysis chamber such as gas pressure values
                         etc.
                    </doc>
                    <field name="pressure" type="NX_FLOAT" units="NX_PRESSURE">
                        <doc>
                             Average pressure in the analysis chamber.
                        </doc>
                    </field>
                </group>
            </group>
            <group name="specimen_monitoring" type="NXcollection" optional="true">
                <doc>
                     A place where details about the initial shape of the specimen can be
                     stored. Ideally, here also data about the shape evolution of the
                     specimen can be stored. There are currently very few techniques only
                     to measure the shape evolution: One is via correlative electron
                     microscopy but this usually evolves an interrupted experiment in which
                     the specimen is transferred, an image taken, and a new evaporation
                     sequence initiated. Another, less accurate method, though, is to
                     monitor the specimen evolution via the in-built camera system (if
                     available) in the instrument. Another method is to use correlated
                     scanning force microscopy methods (pioneered by the imec group,
                     Belgium). A continuous monitoring of the specimen in an correlative
                     electron microscopy/atom probe experiment is planned to be developed
                     by the Jülich group (Dunin-Borkowski/Gault).
                </doc>
                <field name="initial_radius" type="NX_FLOAT" units="NX_LENGTH">
                    <doc>
                         Ideally measured or best elaborated guess of the initial radius of the
                         specimen.
                    </doc>
                </field>
                <field name="shank_angle" type="NX_FLOAT" units="NX_ANGLE">
                    <doc>
                         Ideally measured or best elaborated guess of the shank angle. This is
                         a measure of the specimen taper. Define it in such a way that the base
                         of the specimen is modelled as a conical frustrum so that the shank
                         angle is the (shortest) angle between the specimen space z-axis and a
                         vector on the lateral surface of the cone.
                    </doc>
                </field>
            </group>
            <group name="ion_impact_positions" type="NXprocess" optional="true">
                <doc>
                     This group in the hierarchy should be used to store the ion hit
                     positions. Data post-processing step of analog-to-digital conversion
                     of the detector signals into ion hit positions. For AMETEK LEAP
                     instruments this processing takes place partly in the control unit of
                     the detector partly in the software. The process is controlled by the
                     acquisition/instrument control software (IVAS/APSuite/DAVis). The
                     exact details are, at least in the case of AMETEK instruments, which
                     applies to the majority of atom probe microscopes, kept proprietary
                     and inaccessible. For instruments build by individual research groups,
                     like the Oxcart instrument, individual timing data from the delay-line
                     detector are openly accessible.
                </doc>
                <field name="program" type="NX_CHAR">
                    <doc>
                         Given name of the program that was used to perform this computation.
                         Although for LEAP instruments this program is often the same software
                         as one would specify under program for the NXentry (usually IVAS or AP
                         Suite), the field is required because in cases where data is post-
                         processed with different software it would not be possible to
                         distinguish which portions of the dataset were computed with which
                         software.
                    </doc>
                    <attribute name="version" type="NX_CHAR">
                        <doc>
                             Ideally program version plus build number, or commit hash or
                             description of ever persistent resources where the source code of the
                             program and build instructions can be found so that the program can be
                             configured ideally in such a manner that the result of this
                             computational process is recreatable in the same deterministic manner.
                        </doc>
                    </attribute>
                </field>
                <field name="arrival_time_pairs" type="NX_NUMBER" recommended="true" units="NX_TIME">
                    <doc>
                         Three-dimensional array of raw readings from the analog-to-digital-
                         converter timing circuits of the detector wires.
                    </doc>
                    <dimensions rank="3">
                        <dim index="1" value="2"/>
                        <dim index="2" value="Ndldwires"/>
                        <dim index="3" value="Nions"/>
                    </dimensions>
                </field>
                <field name="hit_positions" type="NX_FLOAT" units="NX_LENGTH">
                    <doc>
                         Evaluated ion impact coordinates at the detector (either as computed
                         from the arrival time data or as reported as the result of a not
                         necessarily further specified processing within commercial control
                         software.
                    </doc>
                    <dimensions rank="2">
                        <dim index="1" value="2"/>
                        <dim index="2" value="Nions"/>
                    </dimensions>
                </field>
                <field name="detection_rate" type="NX_FLOAT" units="NX_DIMENSIONLESS">
                    <doc>
                         Average detection rate over the course of the experiment.
                    </doc>
                </field>
            </group>
            <group name="hit_multiplicity" type="NXprocess" recommended="true">
                <doc>
                     Data post-processing step which is, like the impact position analyses,
                     also usually executed in the integrated control software. This
                     processing yields how many ions were detected with each pulse. In
                     fact, it is possible that multiple ions evaporate and hit the same or
                     different pixels of the detector on the same pulse. These data form
                     the basis to analyses of the so-called (hit) multiplicity of an ion.
                     Multiplicity must not be confused with how many atoms of the same
                     element or isotope, respectively, a molecular ion contains. By
                     contrast, this latter multiplicity is encoded in the (isotope_vector)
                     field within in a (NXion) instance.
                </doc>
                <field name="program" type="NX_CHAR">
                    <doc>
                         Given name of the program that was used to perform this computation.
                         Similar comments as for ion_impact_positions apply.
                    </doc>
                    <attribute name="version" type="NX_CHAR">
                        <doc>
                             Ideally program version plus build number, or commit hash or
                             description of ever persistent resources where the source code of the
                             program and build instructions can be found so that the program can be
                             configured ideally in such a manner that the result of this
                             computational process is recreatable in the same deterministic manner.
                        </doc>
                    </attribute>
                </field>
                <field name="pulses_since_last_ion" type="NX_UINT" optional="true" units="NX_UNITLESS">
                    <doc>
                         Number of pulses since the last detected ion pulse. For multi-hit
                         records, after the first record, this is zero.
                    </doc>
                    <dimensions rank="1">
                        <dim index="1" value="Nions"/>
                    </dimensions>
                </field>
                <field name="hit_multiplicity" type="NX_UINT" recommended="true" units="NX_UNITLESS">
                    <doc>
                         Hit multiplicity.
                    </doc>
                    <dimensions rank="1">
                        <dim index="1" value="Nions"/>
                    </dimensions>
                </field>
                <field name="pulse_id" type="NX_UINT" optional="true" units="NX_UNITLESS">
                    <doc>
                         Number of pulses since the start of the atom probe run/evaporation
                         sequence.
                    </doc>
                    <dimensions rank="1">
                        <dim index="1" value="Nions"/>
                    </dimensions>
                </field>
            </group>
            <group name="ion_filtering" type="NXprocess" recommended="true">
                <doc>
                     Like impact position and hit multiplicity computations, ion filtering
                     is a data post-processing step when users identify which of the
                     detected ions should be included in the voltage-and-bowl correction.
                     This post-processing is usually performed via GUI interaction in the
                     reconstruction pipeline of commercial analysis software like
                     IVAS/APSuite.
                </doc>
                <field name="program" type="NX_CHAR">
                    <doc>
                         Given name of the program that was used to perform this computation.
                         Similar comments as to hit_multiplicity apply.
                    </doc>
                    <attribute name="version" type="NX_CHAR">
                        <doc>
                             Ideally program version plus build number, or commit hash or
                             description of ever persistent resources where the source code of the
                             program and build instructions can be found so that the program can be
                             configured ideally in such a manner that the result of this
                             computational process is recreatable in the same deterministic manner.
                        </doc>
                    </attribute>
                </field>
                <field name="evaporation_id_included" type="NX_BOOLEAN">
                    <doc>
                         Bitmask which is set to true if the ion is considered and false
                         otherwise.
                    </doc>
                    <dimensions rank="1">
                        <dim index="1" value="Nions"/>
                    </dimensions>
                </field>
            </group>
            <group name="voltage_and_bowl_correction" type="NXprocess" recommended="true">
                <doc>
                     Data post-processing step to correct for ion impact position flight
                     path differences, detector biases, and nonlinearities. Also this step
                     is usually performed with commercial software.
                </doc>
                <field name="program" type="NX_CHAR">
                    <doc>
                         Given name of the program that was used to perform this computation.
                         Similar comments as to ion_filtering apply.
                    </doc>
                    <attribute name="version" type="NX_CHAR">
                        <doc>
                             Ideally program version plus build number, or commit hash or
                             description of ever persistent resources where the source code of the
                             program and build instructions can be found so that the program can be
                             configured ideally in such a manner that the result of this
                             computational process is recreatable in the same deterministic manner.
                        </doc>
                    </attribute>
                </field>
                <field name="raw_tof" type="NX_FLOAT" recommended="true" units="NX_TIME">
                    <doc>
                         Raw time-of-flight data as read-out from the acquisition software if
                         these data are or accessible.
                    </doc>
                    <dimensions rank="1">
                        <dim index="1" value="Nions"/>
                    </dimensions>
                </field>
                <field name="calibrated_tof" type="NX_FLOAT" units="NX_TIME">
                    <doc>
                         Calibrated time-of-flight.
                    </doc>
                    <dimensions rank="1">
                        <dim index="1" value="Nions"/>
                    </dimensions>
                </field>
                <group name="tof_calibration" type="NXcollection" optional="true">
                    <doc>
                         The key idea and algorithm of the voltage-and-bowl correction is
                         qualitatively similar for instruments of different manufacturers or
                         research groups. Specific differences exists though in the form of
                         different calibration models. For now we do not wish to resolve or
                         generalize these differences. Rather the purpose of this collection is
                         to provide a container where model-specific parameters and calibration
                         models can be stored if users know these for sure. For AMETEK LEAP
                         systems this should be the place for storing initial calibration
                         values. These values are accessible normally only by AMETEK service
                         engineers and used by them for calibrating for the detector and
                         instrument. Furthermore, one could then also store here the
                         iteratively identified calibrations which scientists will get
                         displayed in e.g. AP Suite while executing the voltage-and-bowl
                         correction as part of the reconstruction pipeline.
                    </doc>
                </group>
            </group>
            <group name="mass_to_charge_conversion" type="NXprocess" recommended="true">
                <doc>
                     Data post-processing step in which calibrated time-of-flight data
                     (tof) are interpreted into mass-to-charge-state ratios.
                </doc>
                <field name="program" type="NX_CHAR">
                    <doc>
                         Given name of the program that was used to perform this computation.
                         Similar comments as voltage_and_bowl_correction apply.
                    </doc>
                    <attribute name="version" type="NX_CHAR">
                        <doc>
                             Ideally program version plus build number, or commit hash or
                             description of ever persistent resources where the source code of the
                             program and build instructions can be found so that the program can be
                             configured ideally in such a manner that the result of this
                             computational process is recreatable in the same deterministic manner.
                        </doc>
                    </attribute>
                </field>
                <group name="parameter" type="NXcollection" recommended="true">
                    <doc>
                         Like for the voltage-and-bowl correction, this collection should be
                         used for storing vendor-specific calibration models if these are
                         available.
                    </doc>
                </group>
                <field name="mass_to_charge" type="NX_FLOAT" units="NX_ANY">
                    <doc>
                         Mass-to-charge-state ratios
                    </doc>
                    <dimensions rank="1">
                        <dim index="1" value="Nions"/>
                    </dimensions>
                </field>
            </group>
            <group name="reconstruction" type="NXprocess" recommended="true">
                <doc>
                     Data post-processing step to create a tomographic reconstruction of
                     the specimen based on selected calibrated ion hit positions, the
                     evaporation sequence, and voltage curve data. Very often scientists
                     use own software scripts according to published, so-called
                     reconstruction protocols, i.e. numerical recipes how to compute x, y,
                     z atomic positions from the input data.
                </doc>
                <field name="program" type="NX_CHAR">
                    <doc>
                         Given name of the program that was used to perform this computation.
                         Similar comments as voltage_and_bowl_correction apply.
                    </doc>
                    <attribute name="version" type="NX_CHAR">
                        <doc>
                             Ideally program version plus build number, or commit hash or
                             description of ever persistent resources where the source code of the
                             program and build instructions can be found so that the program can be
                             configured ideally in such a manner that the result of this
                             computational process is recreatable in the same deterministic manner.
                        </doc>
                    </attribute>
                </field>
                <field name="protocol_name" type="NX_CHAR" recommended="true">
                    <doc>
                         Qualitative statement about which algorithmic approach, i.e.
                         reconstruction protocol was used.
                    </doc>
                    <enumeration>
                        <item value="bas_original"/>
                        <item value="bas_modified"/>
                        <item value="geiser"/>
                        <item value="gault"/>
                        <item value="ivas"/>
                        <item value="apsuite"/>
                        <item value="other"/>
                    </enumeration>
                </field>
                <field name="reconstructed_positions" type="NX_FLOAT" units="NX_LENGTH">
                    <doc>
                         Three-dimensional reconstructed positions of the ions. Interleaved
                         array of x, y, z positions in the specimen space.
                    </doc>
                    <dimensions rank="2">
                        <dim index="1" value="3"/>
                        <dim index="2" value="Nions"/>
                    </dimensions>
                </field>
                <group name="reconstruction_parameter" type="NXcollection" recommended="true">
                    <doc>
                         Different models and associated algorithms, i.e. (numerical) protocols
                         exist to reconstruct atom probe data. Although these approaches are
                         qualitatively similar, each protocol uses different parameters (and
                         interprets these differently). The source code to IVAS/APSuite is not
                         open. For now we store the reconstruction parameter in a collection.
                    </doc>
                </group>
            </group>
            <group name="ranging" type="NXprocess" recommended="true">
                <doc>
                     Data post-processing step in which elemental, isotopic, and/or
                     molecular identities are assigned to the ions. The documentation of
                     these steps is based on ideas described in the literature (M. K&quot;uhbach
                     et al. 2021, Microsc. Microanal.).
                </doc>
                <field name="program" type="NX_CHAR">
                    <doc>
                         Given name of the program that was used to perform this computation.
                         Apart from the classical approach to use AMETEK software for this
                         processing step, a number of open-source alternative tools been
                         designed for executing this task. Therefore, it is essential to
                         document which tool was used.
                    </doc>
                    <attribute name="version" type="NX_CHAR">
                        <doc>
                             Ideally program version plus build number, or commit hash or
                             description of ever persistent resources where the source code of the
                             program and build instructions can be found so that the program can be
                             configured ideally in such a manner that the result of this
                             computational process is recreatable in the same deterministic manner.
                        </doc>
                    </attribute>
                </field>
                <field name="number_of_iontypes" type="NX_UINT" units="NX_UNITLESS">
                    <doc>
                         How many ion types are distinguished.
                    </doc>
                </field>
                <field name="maximum_number_of_atoms_per_molecular_ion" type="NX_UINT" units="NX_UNITLESS">
                    <doc>
                         Assumed maximum value that suffices to store all relevant molecular
                         ions, even the most complicated ones. Currently a value of 32 is used.
                    </doc>
                </field>
                <group name="mass_to_charge_distribution" type="NXprocess" recommended="true">
                    <doc>
                         Specifies the computation of the mass-to-charge histogram. Usually
                         mass-to-charge values are studied as an ensemble quantity,
                         specifically these values are binned. The (NXprocess) stores the
                         settings of this binning.
                    </doc>
                    <field name="program" type="NX_CHAR">
                        <doc>
                             Given name of the program that was used to perform this binning. If
                             the computation is a integrated into the ranging tool, type .
                        </doc>
                        <attribute name="version" type="NX_CHAR">
                            <doc>
                                 Ideally program version plus build number, or commit hash or
                                 description of ever persistent resources where the source code of the
                                 program and build instructions can be found so that the program can be
                                 configured ideally in such a manner that the result of this
                                 computational process is recreatable in the same deterministic manner.
                                 If the version is the same as for the ranging tool, type .
                            </doc>
                        </attribute>
                    </field>
                    <field name="range_minmax" type="NX_FLOAT" units="NX_ANY">
                        <doc>
                             Smallest and largest mass-to-charge value.
                        </doc>
                        <dimensions rank="1">
                            <dim index="1" value="2"/>
                        </dimensions>
                    </field>
                    <field name="range_increment" type="NX_FLOAT" units="NX_ANY">
                        <doc>
                             Binning width
                        </doc>
                    </field>
                </group>
                <group name="background_quantification" type="NXprocess" recommended="true">
                    <doc>
                         Details of the background model which was used to correct the total
                         counts per bin into used counts.
                    </doc>
                    <field name="program" type="NX_CHAR">
                        <doc>
                             Given name of the program that was used to perform the background
                             quantification. If the computation is a integrated into the ranging
                             tool, type .
                        </doc>
                        <attribute name="version" type="NX_CHAR">
                            <doc>
                                 Ideally program version plus build number, or commit hash or
                                 description of ever persistent resources where the source code of the
                                 program and build instructions can be found so that the program can be
                                 configured ideally in such a manner that the result of this
                                 computational process is recreatable in the same deterministic manner.
                                 If the version is the same as for the ranging tool, type .
                            </doc>
                        </attribute>
                    </field>
                </group>
                <group name="peak_search_and_deconvolution" type="NXprocess" recommended="true">
                    <doc>
                         How where peaks in the background-corrected mass-to-charge histogram
                         identified.
                    </doc>
                    <field name="program" type="NX_CHAR">
                        <doc>
                             Given name of the program that was used to search and detect peaks. If
                             the computation is a integrated into the ranging tool type .
                        </doc>
                        <attribute name="version" type="NX_CHAR">
                            <doc>
                                 Ideally program version plus build number, or commit hash or
                                 description of ever persistent resources where the source code of the
                                 program and build instructions can be found so that the program can be
                                 configured ideally in such a manner that the result of this
                                 computational process is recreatable in the same deterministic manner.
                                 If the version is the same as for the ranging tool, type .
                            </doc>
                        </attribute>
                    </field>
                    <group type="NXpeak" optional="true">
                        <doc>
                             List of peaks.
                        </doc>
                        <field name="label" type="NX_CHAR" optional="true">
                            <doc>
                                 Human-readable identifier to specify which concept/entity the peak
                                 identifies.
                            </doc>
                        </field>
                        <field name="peak_model" type="NX_CHAR">
                            <doc>
                                 Is the peak described analytically via a functional form or is it
                                 described empirically via measured/reported intensity/counts as a
                                 function of an independent variable.
                            </doc>
                            <enumeration>
                                <item value="empirical"/>
                                <item value="gaussian"/>
                                <item value="lorentzian"/>
                            </enumeration>
                        </field>
                        <field name="position" type="NX_NUMBER" units="NX_ANY">
                            <doc>
                                 In the case of an empirical description of the peak and its shoulders,
                                 this array holds the positions were independent variable values were
                                 taken.
                            </doc>
                            <dimensions rank="1">
                                <dim index="1" value="Nsupport"/>
                            </dimensions>
                        </field>
                        <field name="intensity" type="NX_NUMBER" units="NX_ANY">
                            <doc>
                                 In the case of an empirical description of the peak and its shoulders,
                                 this array holds the intensity/count values at each position.
                            </doc>
                            <dimensions rank="1">
                                <dim index="1" value="Nsupport"/>
                            </dimensions>
                        </field>
                        <group type="NXcollection" optional="true">
                            <doc>
                                 In the case of an analytical description this group can be used to
                                 hold parameter of the functional form. For example in the case of
                                 Gaussian peaks mu, sigma, and cut-off values and background intensity.
                            </doc>
                        </group>
                    </group>
                </group>
                <group name="peak_identification" type="NXprocess" recommended="true">
                    <doc>
                         Details about how peaks, with taking into account error models, were
                         interpreted as an iontype or not.
                    </doc>
                    <field name="program" type="NX_CHAR">
                        <doc>
                             Given name of the program that was used to perform identify peaks. If
                             the computation is a integrated into the ranging tool, type .
                        </doc>
                        <attribute name="version" type="NX_CHAR">
                            <doc>
                                 Ideally program version plus build number, or commit hash or
                                 description of ever persistent resources where the source code of the
                                 program and build instructions can be found so that the program can be
                                 configured ideally in such a manner that the result of this
                                 computational process is recreatable in the same deterministic manner.
                                 If the version is the same as for the ranging tool, type .
                            </doc>
                        </attribute>
                    </field>
                    <group type="NXion" optional="true">
                        <doc>
                             The individual ions and their set of mass-to-charge intervals
                             (ranges). If ranging was performed as a computational step then the
                             NeXus-writing software needs to assure that there is always a default
                             ion type which is the unknown ion type. By definition this unknown
                             type has 0 as the id and a default associated mass-to-charge-state
                             ratio interval of [0, 0.001] Da.
                        </doc>
                        <field name="ion_type" type="NX_UINT" units="NX_UNITLESS">
                            <doc>
                                 Ion type (ion species) identifier. The identifier zero is reserved for
                                 the special unknown ion type.
                            </doc>
                        </field>
                        <field name="isotope_vector" type="NX_UINT" units="NX_UNITLESS">
                            <doc>
                                 A vector of isotope hash values. These values have to be stored in a
                                 decreasingly sorted array. The array is filled with zero hash values
                                 indicating unused places. The individual hash values are built with
                                 the following hash function: Hashvalue = Z + N*256 with Z the number
                                 of protons and N the number of neutrons of the isotope respectively. Z
                                 and N have to be 8-bit unsigned integers.
                            </doc>
                            <dimensions rank="1">
                                <dim index="1" value="Nivecmax"/>
                            </dimensions>
                        </field>
                        <field name="charge_state" type="NX_INT" recommended="true" units="NX_DIMENSIONLESS">
                            <doc>
                                 Signed charge state of the ion in multiples of the elementary electron
                                 charge. Only positive values will be measured in atom probe microscopy
                                 as the ions are accelerated by a negatively signed bias electric
                                 field. In the case that the charge state is not explicitly
                                 recoverable, the value should be set to zero. This is for example the
                                 case when using classical range file formats like RNG, RRNG for atom
                                 probe data. These file formats do not document the charge state
                                 explicitly but report an integer with the atom type which can be used
                                 to compute the charge state via the theoretically-known mass-to-
                                 charge-state-ratios of the elements.
                            </doc>
                        </field>
                        <field name="name" type="NX_CHAR" optional="true">
                            <doc>
                                 Human-readable ion type name (e.g. Al +++), i.e. ASCII UTF-8 character
                                 array, ideally using LaTeX notation to specify the ion and charge
                                 state. Examples are 12C+ or Al+++. Although this name may be human-
                                 readable and intuitive, parsing such names becomes impractical for
                                 more complicated cases. Therefore, the isotope_vector should be the
                                 preferred machine-readable format in use.
                            </doc>
                        </field>
                        <field name="mass_to_charge_range" type="NX_FLOAT" units="NX_ANY">
                            <doc>
                                 Associated lower (mqmin) and upper (mqmax) bounds of mass-to-charge-
                                 state ratio interval(s) [mqmin, mqmax] (boundaries included) for which
                                 the respective ion is labelled as an ion of the here referred to
                                 ion_type.
                            </doc>
                            <dimensions rank="2">
                                <dim index="1" value="2"/>
                                <dim index="2" value="Nranges"/>
                            </dimensions>
                        </field>
                    </group>
                </group>
            </group>
        </group>
    </group>
</definition>
